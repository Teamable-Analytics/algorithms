{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{% static 'css/bootstrap/v5.1.3/bootstrap.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

    <link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>

<body>
<header class="d-flex flex-row align-items-center p-3">
    <div class="img-container">
        <a href="index.html"><img src="{% static 'assets/img/logo-transparent-blue.png' %}"
                                  alt="Teamable Analytics Logo"/></a>
    </div>
    <span class="title"><a href="index.html">Teamable Analytics</a></span>
</header>

<main class="container d-flex flex-column gap-1 my-5">
    <h1>Teamable Analytics API</h1>

    <section>
        <h2>About our API</h2>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer malesuada quam et efficitur lacinia.
            Suspendisse justo massa, congue ut nulla eleifend, laoreet eleifend sem. Nam interdum quam lorem. Vestibulum
            sed est a ex sodales rhoncus nec non nisl. Pellentesque habitant morbi tristique senectus et netus et
            malesuada fames ac turpis egestas. Vestibulum non nisi enim. Proin sit amet orci non metus lacinia ultrices.
            Nam sit amet tortor a augue mollis ornare a eu sapien. Nunc fermentum tincidunt dolor, eu hendrerit metus.
            Sed hendrerit pretium metus ac finibus. Aenean id sem sapien. Donec bibendum nisl nisl, ac facilisis nisl
            varius at. Pellentesque at tincidunt lacus, eget accumsan lectus.<br/><br/>
            Mauris venenatis commodo lacus, et vestibulum metus imperdiet vel. Mauris elementum enim vitae tellus
            faucibus, vitae auctor velit suscipit. Mauris venenatis porttitor convallis. Vestibulum egestas eros vel
            sodales malesuada. Etiam nec lacus euismod, consequat lectus sit amet, sagittis mauris. Orci varius natoque
            penatibus et magnis dis parturient montes, nascetur ridiculus mus. Quisque interdum tristique mauris ac
            interdum. Mauris in sollicitudin libero. Etiam congue egestas sapien, id interdum diam posuere vel. Maecenas
            vestibulum orci eu sapien pellentesque aliquam. Cras ac laoreet nisi. Proin in nunc dui. Mauris ultrices
            scelerisque ante id ultricies.<br/><br/>
            Phasellus pharetra risus eget volutpat eleifend. In ac orci quis neque semper pharetra rutrum vitae nulla.
            Morbi mollis urna id suscipit venenatis. Curabitur laoreet, nunc auctor fermentum iaculis, quam nisl
            vestibulum libero, in auctor ipsum orci eget lacus. Aenean auctor nisi eget iaculis imperdiet. Sed molestie
            nisi et pulvinar lobortis. Etiam quis tempor eros. Ut consequat tortor commodo nisl cursus condimentum
            maximus at urna. Nullam nec purus nibh. Nunc a convallis augue, ac placerat risus.
        </p>
    </section>
    <section>
        <h2>How to use it</h2>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer malesuada quam et efficitur lacinia.
            Suspendisse justo massa, congue ut nulla eleifend, laoreet eleifend sem. Nam interdum quam lorem. Vestibulum
            sed est a ex sodales rhoncus nec non nisl. Pellentesque habitant morbi tristique senectus et netus et
            malesuada fames ac turpis egestas. Vestibulum non nisi enim. Proin sit amet orci non metus lacinia ultrices.
            Nam sit amet tortor a augue mollis ornare a eu sapien. Nunc fermentum tincidunt dolor, eu hendrerit metus.
            Sed hendrerit pretium metus ac finibus. Aenean id sem sapien. Donec bibendum nisl nisl, ac facilisis nisl
            varius at. Pellentesque at tincidunt lacus, eget accumsan lectus.<br/><br/>
            Mauris venenatis commodo lacus, et vestibulum metus imperdiet vel. Mauris elementum enim vitae tellus
            faucibus, vitae auctor velit suscipit. Mauris venenatis porttitor convallis. Vestibulum egestas eros vel
            sodales malesuada. Etiam nec lacus euismod, consequat lectus sit amet, sagittis mauris. Orci varius natoque
            penatibus et magnis dis parturient montes, nascetur ridiculus mus. Quisque interdum tristique mauris ac
            interdum. Mauris in sollicitudin libero. Etiam congue egestas sapien, id interdum diam posuere vel. Maecenas
            vestibulum orci eu sapien pellentesque aliquam. Cras ac laoreet nisi. Proin in nunc dui. Mauris ultrices
            scelerisque ante id ultricies.<br/><br/>
            Phasellus pharetra risus eget volutpat eleifend. In ac orci quis neque semper pharetra rutrum vitae nulla.
            Morbi mollis urna id suscipit venenatis. Curabitur laoreet, nunc auctor fermentum iaculis, quam nisl
            vestibulum libero, in auctor ipsum orci eget lacus. Aenean auctor nisi eget iaculis imperdiet. Sed molestie
            nisi et pulvinar lobortis. Etiam quis tempor eros. Ut consequat tortor commodo nisl cursus condimentum
            maximus at urna. Nullam nec purus nibh. Nunc a convallis augue, ac placerat risus.
        </p>
    </section>
    <section>
        <h2>Playground</h2>
        <div class="d-flex flex-column gap-4">
            <div class="d-flex flex-row align-items-center gap-2">
                <label class="fw-bolder text-primary" for="demo-url">POST</label>
                <input class="border rounded-2 w-50" style="height: 2.5rem; padding: 0 1rem" type="text" id="demo-url"
                       value="https://api.teamableanalytics.ok.ubc.ca/api/generate/teams/" disabled>
                <button class="btn btn-primary" type="button" id="run-button">Run</button>
                <button class="btn btn-secondary" type="button" id="copy-url-button">Copy request as CURL</button>
            </div>

            <div>
                <label for="demo-input">Body</label>
                <textarea class="border rounded-2 w-100 text-muted"
                          style="height: 25rem; padding: 1rem; font-family: 'Inconsolata', monospace"
                          id="demo-input"></textarea>
            </div>


            <!-- Only show output when there is output -->
            <div id="demo-output-wrapper">
                <label for="demo-output">Response</label>
                <textarea class="border rounded-2 w-100 text-muted"
                          style="height: 20rem; padding: 1rem; font-family: 'Inconsolata', monospace; margin-bottom: 5rem;"
                          disabled
                          id="demo-output"></textarea>
            </div>
        </div>
    </section>
</main>
</body>


<script>

    function sanitizeJson(json) {
        const invalidChars = ["\n", "\t", "\r"];
        return invalidChars.reduce((acc, cur) => {
            return acc.replace(cur, "");
        }, json);
    }

    function jsonBodyToStr(rawBody) {
        try {
            const sanitizedBody = sanitizeJson(rawBody);
            const body = JSON.parse(sanitizedBody);
            return JSON.stringify(body, null);
        } catch (e) {
            return rawBody;
        }
    }

    function handleCopyAsCURL() {
        const url = document.getElementById("demo-url").value;
        const rawBody = document.getElementById("demo-input").value;
        const body = jsonBodyToStr(rawBody);
        const curl = `curl -X POST -H "Content-Type: application/json" -d '${body}' ${url}`;
        navigator.clipboard.writeText(curl).then((a) => {
            alert("Copied to clipboard!");
        }).catch((e) => {
            alert("Failed to copy to clipboard. Please try again.");
        });
    }

    function handleRun() {
        const url = document.getElementById("demo-url").value;
        const body = sanitizeJson(document.getElementById("demo-input").value);

        // Validate JSON
        try {
            JSON.parse(body);
        } catch (e) {
            alert("Invalid JSON");
            return;
        }

        const output = document.getElementById("demo-output");
        output.value = "Loading...";
        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "X-CSRFToken": "csrftoken",
            },
            body: body,
        }).then((response) => {
            console.log("AHAHAHAHA", response)
            if (!response.ok) {
                throw new Error(response.statusText);
            }
            return response.json();
        }).then((json) => {
            const teamData = json["teams"];
            output.value = JSON.stringify(teamData, null, 2);
        }).catch((e) => {
            output.value = e;
        });
    }


    // Event listeners
    document.getElementById("copy-url-button").addEventListener("click", handleCopyAsCURL);
    document.getElementById("run-button").addEventListener("click", handleRun);

</script>
</html>
