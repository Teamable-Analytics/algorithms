{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{% static 'css/bootstrap/v5.1.3/bootstrap.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>

<body>
<header>
    <a href=href="https://teamableanalytics.ok.ubc.ca/homepage/" class="d-flex flex-row align-items-center p-3">
        <div class="img-container">
            <img src="{% static 'assets/img/logo-transparent-blue.png' %}" alt="Teamable Analytics Logo"/>
        </div>
        <span class="title">Teamable Analytics</span>
    </a>
</header>

<main class="container d-flex flex-column gap-1 my-5">
    <h1>Teamable Analytics API</h1>

    <section>
        <h2>About the API</h2>
        <p>
{#            Generate English for me plz#}
            This is the API for the Teamable Analytics project. View project at <a href="https://teamableanalytics.ok.ubc.ca/homepage/">project homepage</a>.<br/>
            The API provides a simple interface for generating teams with advanced options such as:
            <ul style="margin-top: -1rem">
                <li>Flexible team size</li>
                <li>Variety of team member attributes</li>
                <li>Different algorithms choice</li>
            </ul>
        </p>
    </section>
    <section>
        <h2>How to use it</h2>
        <p>
            <ol>
        <li>Contact our Project Manager <a href="mailto:bowen.hui@ubc.ca"><b>Bowen Hui</b></a> to get an API key.</li>
                <li>Learn more about our architecture at our <a href="https://teamableanalytics.ok.ubc.ca/homepage/">detailed documentations page</a>.</li>
                <li>Use the playground below to test out the API.</li>
            </ol>
        </p>
    </section>
    <section>
        <h2>Playground</h2>
        <div class="d-flex flex-column gap-4">
            <div class="d-flex flex-row align-items-center gap-2">
                <label class="fw-bolder text-primary" for="demo-url">POST</label>
                <input class="border rounded-2 w-50" style="height: 2.5rem; padding: 0 1rem" type="text" id="demo-url"
                       value="https://api.teamableanalytics.ok.ubc.ca/api/generate/teams/" disabled>
                <button class="btn btn-primary" type="button" id="run-button">Run</button>
                <button class="btn btn-secondary" type="button" id="copy-url-button">Copy request as CURL</button>
            </div>

            <div>
                <label for="demo-input">Body</label>
                <textarea class="border rounded-2 w-100 text-muted"
                          style="height: 25rem; padding: 1rem; font-family: 'Inconsolata', monospace"
                          id="demo-input"></textarea>
            </div>


            <!-- Only show output when there is output -->
            <div id="demo-output-wrapper">
                <label for="demo-output">Response</label>
                <textarea class="border rounded-2 w-100 text-muted"
                          style="height: 20rem; padding: 1rem; font-family: 'Inconsolata', monospace; margin-bottom: 5rem;"
                          disabled
                          id="demo-output"></textarea>
            </div>
        </div>
    </section>
</main>
</body>


<script>

    function sanitizeJson(json) {
        const invalidChars = ["\n", "\t", "\r"];
        return invalidChars.reduce((acc, cur) => {
            return acc.replace(cur, "");
        }, json);
    }

    function jsonBodyToStr(rawBody) {
        try {
            const sanitizedBody = sanitizeJson(rawBody);
            const body = JSON.parse(sanitizedBody);
            return JSON.stringify(body, null);
        } catch (e) {
            return rawBody;
        }
    }

    function handleCopyAsCURL() {
        const url = document.getElementById("demo-url").value;
        const rawBody = document.getElementById("demo-input").value;
        const body = jsonBodyToStr(rawBody);
        const curl = `curl -X POST -H "Content-Type: application/json" -d '${body}' ${url}`;
        navigator.clipboard.writeText(curl).then((a) => {
            alert("Copied to clipboard!");
        }).catch((e) => {
            alert("Failed to copy to clipboard. Please try again.");
        });
    }

    function handleRun() {
        const url = document.getElementById("demo-url").value;
        const body = sanitizeJson(document.getElementById("demo-input").value);

        // Validate JSON
        try {
            JSON.parse(body);
        } catch (e) {
            alert("Invalid JSON");
            return;
        }

        const output = document.getElementById("demo-output");
        output.value = "Loading...";
        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "X-CSRFToken": "csrftoken",
            },
            body: body,
        }).then((response) => {
            console.log("AHAHAHAHA", response)
            if (!response.ok) {
                throw new Error(response.statusText);
            }
            return response.json();
        }).then((json) => {
            const teamData = json["teams"];
            output.value = JSON.stringify(teamData, null, 2);
        }).catch((e) => {
            output.value = e;
        });
    }


    // Event listeners
    document.getElementById("copy-url-button").addEventListener("click", handleCopyAsCURL);
    document.getElementById("run-button").addEventListener("click", handleRun);

</script>
</html>
